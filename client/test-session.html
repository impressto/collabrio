<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Session for File Injection Demo</title>
    <script type="module">
        // Import configuration from Vite environment
        import config from '/src/config.js'
        
        // Make config available globally for the rest of the script
        window.COLLABRIO_CONFIG = config
        
        // Load Socket.IO from CDN since we can't easily import it in HTML
        const script = document.createElement('script')
        script.src = 'https://cdn.socket.io/4.7.4/socket.io.min.js'
        script.onload = initializeTest
        document.head.appendChild(script)
        
        function initializeTest() {
            const socket = io(config.socketServerUrl)
            const testSessionId = 'demo-test-session-' + Date.now()
            
            // Update UI elements
            document.getElementById('serverUrl').textContent = config.socketServerUrl
            document.getElementById('sessionId').textContent = testSessionId
            
            socket.on('connect', () => {
                if (config.debug) console.log('Connected to server')
                document.getElementById('status').textContent = 'Connected'
                
                // Join the test session
                socket.emit('join-session', {
                    sessionId: testSessionId,
                    clientId: 'demo-client-' + Date.now()
                })
            })
            
            socket.on('session-joined', (data) => {
                if (config.debug) console.log('Joined session:', data)
                document.getElementById('status').textContent = 'Session active - ready for file injection'
            })
            
            socket.on('document-update', (data) => {
                if (config.debug) console.log('Document updated:', data)
                document.getElementById('document').value = data.content
            })
            
            socket.on('server-text-injection', (data) => {
                if (config.debug) console.log('Text injected:', data)
                const currentContent = document.getElementById('document').value
                const newContent = currentContent + '\n[' + data.type.toUpperCase() + '] ' + data.text
                document.getElementById('document').value = newContent
            })
            
            socket.on('disconnect', () => {
                document.getElementById('status').textContent = 'Disconnected'
            })
            
            // Keep the session alive using configured interval
            setInterval(() => {
                if (socket.connected) {
                    if (config.debug) console.log('Session alive:', testSessionId)
                }
            }, config.sessionKeepAliveInterval)
            
            // Copy session ID to clipboard when clicked
            document.getElementById('sessionId').onclick = function() {
                navigator.clipboard.writeText(testSessionId).then(() => {
                    alert('Session ID copied to clipboard!')
                })
            }
        }
    </script>
</head>
<body>
    <h1>ü§ù Collabrio Test Session</h1>
    <p><strong>Socket Server:</strong> <span id="serverUrl">Loading...</span></p>
    <p><strong>Session ID:</strong> <span id="sessionId" style="cursor: pointer; text-decoration: underline;">connecting...</span></p>
    <p><strong>Status:</strong> <span id="status">Initializing...</span></p>
    <textarea id="document" style="width: 100%; height: 300px; font-family: monospace;" readonly placeholder="Waiting for file injection messages..."></textarea>
    
    <div style="margin-top: 1rem; padding: 1rem; background: #f5f5f5; border-radius: 4px;">
        <h3>File Injection Instructions:</h3>
        <p>1. Copy the session ID above</p>
        <p>2. Create a file: <code>socket-server/messages/{sessionId}_bot.txt</code></p>
        <p>3. Add your message content to the file</p>
        <p>4. Watch it appear in the textarea above!</p>
    </div>
</body>
</html>